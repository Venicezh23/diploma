BEGIN;

DROP TABLE IF EXISTS `residence`;
DROP TABLE IF EXISTS `gov_sector`;
DROP TABLE IF EXISTS `priv_sector`;
DROP TABLE IF EXISTS `user`;
DROP TABLE IF EXISTS `register_gov`;
DROP TABLE IF EXISTS `register_priv`;
DROP TABLE IF EXISTS `gov_usage`;
DROP TABLE IF EXISTS `priv_usage`;

CREATE TABLE `residence` (
`RES_ID` 	int NOT NULL AUTO_INCREMENT,
`RES_TYPE` 	varchar(45) NOT NULL,
PRIMARY KEY (`RES_ID`));

CREATE TABLE `gov_sector` (
`GOV_ID` 	int NOT NULL AUTO_INCREMENT,
`GOV_NAME` 	varchar(45) NOT NULL,
`DATE_ADDED` 	datetime DEFAULT NULL,
PRIMARY KEY (`GOV_ID`));

CREATE TABLE `priv_sector` (
`PRIV_ID` 	int NOT NULL AUTO_INCREMENT,
`PRIV_NAME` 	varchar(45) NOT NULL,
`DATE_ADDED` 	datetime DEFAULT NULL,
PRIMARY KEY (`PRIV_ID`));

CREATE TABLE `user` (
`LOGIN` 		varchar(45) NOT NULL,
`PASSWORDHASHED` 	varchar(256) NOT NULL,
`NAME` 			varchar(45) NOT NULL,
`EMAIL` 		varchar(45) DEFAULT NULL,
`MOBILE` 		varchar(45) DEFAULT NULL,
`RES_ID` 		int NOT NULL,
PRIMARY KEY (`LOGIN`),
KEY `RES_ID_FK_USER_idx` (`RES_ID`),
CONSTRAINT `RES_ID_FK_USER` FOREIGN KEY (`RES_ID`) REFERENCES `residence` (`RES_ID`)
);

CREATE TABLE `register_gov` (
`LOGIN` 	varchar(45) NOT NULL,
`GOV_ID` 	int NOT NULL,
PRIMARY KEY (`LOGIN`,`GOV_ID`),
KEY `GOV_ID_FK_REGISTER_GOV_idx` (`GOV_ID`),
CONSTRAINT `GOV_ID_FK_REGISTER_GOV` FOREIGN KEY (`GOV_ID`) REFERENCES `gov_sector` (`GOV_ID`),
CONSTRAINT `LOGIN_FK_REGISTER_GOV` FOREIGN KEY (`LOGIN`) REFERENCES `user` (`LOGIN`)
);

CREATE TABLE `register_priv` (
`LOGIN` 	varchar(45) NOT NULL,
`PRIV_ID` 	int NOT NULL,
PRIMARY KEY (`LOGIN`,`PRIV_ID`),
KEY `PRIV_ID_FK_REGISTER_PRIV_idx` (`PRIV_ID`),
CONSTRAINT `LOGIN_FK_REGISTER_PRIV` FOREIGN KEY (`LOGIN`) REFERENCES `user` (`LOGIN`),
CONSTRAINT `PRIV_ID_FK_REGISTER_PRIV` FOREIGN KEY (`PRIV_ID`) REFERENCES `priv_sector` (`PRIV_ID`)
);

CREATE TABLE `gov_usage` (
`GOV_USAGE_ID` 	int NOT NULL AUTO_INCREMENT,
`LOGIN` 	varchar(45) NOT NULL,
`GOV_ID` 	int NOT NULL,
`DATE_TIME` 	datetime NOT NULL,
PRIMARY KEY (`GOV_USAGE_ID`),
KEY `LOGIN_FK_GOV_USAGE_idx` (`LOGIN`),
KEY `GOV_ID_FK_GOV_USAGE_idx` (`GOV_ID`),
CONSTRAINT `GOV_ID_FK_GOV_USAGE` FOREIGN KEY (`GOV_ID`) REFERENCES `gov_sector` (`GOV_ID`),
CONSTRAINT `LOGIN_FK_GOV_USAGE` FOREIGN KEY (`LOGIN`) REFERENCES `user` (`LOGIN`)
);

CREATE TABLE `priv_usage` (
`PRIV_USAGE_ID` 	int NOT NULL AUTO_INCREMENT,
`LOGIN` 		varchar(45) NOT NULL,
`PRIV_ID` 		int NOT NULL,
`DATE_TIME` 		datetime NOT NULL,
PRIMARY KEY (`PRIV_USAGE_ID`),
KEY `LOGIN_FK_PRIV_USAGE_idx` (`LOGIN`),
KEY `PRIV_ID_FK_PRIV_USAGE_idx` (`PRIV_ID`),
CONSTRAINT `LOGIN_FK_PRIV_USAGE` FOREIGN KEY (`LOGIN`) REFERENCES `user` (`LOGIN`),
CONSTRAINT `PRIV_ID_FK_PRIV_USAGE` FOREIGN KEY (`PRIV_ID`) REFERENCES `priv_sector` (`PRIV_ID`)
);